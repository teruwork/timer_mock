<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å®Œäº†æ¸ˆã¿ä¸€è¦§</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    let currentSortKey = null;
    let currentSortAsc = true;

    function loadRecords() {
      return JSON.parse(localStorage.getItem("completedRecords") || "[]");
    }

    function displayRecords(records) {
      const tbody = document.getElementById("recordTable");
      tbody.innerHTML = "";
      records.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="p-2 border">${record.date}</td>
          <td class="p-2 border">${record.duration}</td>
          <td class="p-2 border">${record.startTime || ''}</td>
          <td class="p-2 border">${record.endTime || ''}</td>
          <td class="p-2 border">${record.location || ""}</td>
          <td class="p-2 border">${record.mode || ""}</td>
          <td class="p-2 border">${record.carNumber}</td>
          <td class="p-2 border">${record.company || ""}</td>
          <td class="p-2 border">${record.brand || ""}</td>
          <td class="p-2 border">${record.tankNumber || ""}</td>
          <td class="p-2 border">${record.remarks || ""}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterRecords() {
      const from = document.getElementById("searchFrom").value;
      const to = document.getElementById("searchTo").value;
      const car = document.getElementById("searchCar").value.trim();
      const company = document.getElementById("searchCompany").value.trim();
      const tank = document.getElementById("searchTank").value.trim();
      const brand = document.getElementById("searchBrand").value.trim();
      const remarks = document.getElementById("searchRemarks").value.trim();

      const all = loadRecords();
      const filtered = all.filter(r => {
        return (
          (!from || r.date >= from) &&
          (!to || r.date <= to) &&
          (!car || r.carNumber.includes(car)) &&
          (!company || (r.company && r.company === company)) &&
          (!tank || (r.tankNumber && r.tankNumber === tank)) &&
          (!brand || (r.brand && r.brand === brand)) &&
          (!remarks || (r.remarks && r.remarks.includes(remarks)))
        );
      });

      if (currentSortKey) {
        filtered.sort((a, b) => {
          if (a[currentSortKey] < b[currentSortKey]) return currentSortAsc ? -1 : 1;
          if (a[currentSortKey] > b[currentSortKey]) return currentSortAsc ? 1 : -1;
          return 0;
        });
      }

      displayRecords(filtered);
    }

    function sortBy(key) {
      if (currentSortKey === key) {
        currentSortAsc = !currentSortAsc;
      } else {
        currentSortKey = key;
        currentSortAsc = true;
      }
      filterRecords();
    }

    function toggleAdvancedSearch() {
      const adv = document.getElementById("advancedSearch");
      adv.classList.toggle("hidden");
    }

    function copyToClipboard() {
      const table = document.getElementById("recordTable");
      const headers = [
        "æ—¥ä»˜", "è¨ˆæ¸¬æ™‚é–“", "é–‹å§‹æ™‚åˆ»", "çµ‚äº†æ™‚åˆ»", "å ´æ‰€", "å‡ºè·/å—å…¥",
        "è»Šä¸¡ç•ªå·", "é‹é€ä¼šç¤¾", "éŠ˜æŸ„", "ã‚¿ãƒ³ã‚¯No.", "å‚™è€ƒ"
      ];
      let text = headers.join("\t") + "\n";
      for (const row of table.rows) {
        text += [...row.cells].map(cell => cell.textContent).join("\t") + "\n";
      }
      navigator.clipboard.writeText(text).then(() => alert("ğŸ“‹ ãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ãã§ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
    }

    window.onload = () => filterRecords();
  </script>
</head>
<body class="bg-gray-100 p-4 text-sm">
  <div class="max-w-7xl mx-auto bg-white p-4 rounded-xl shadow">
    <h1 class="text-lg font-bold mb-4 text-center">âœ… å®Œäº†æ¸ˆã¿ä¸€è¦§</h1>

    <!-- æ¤œç´¢æ¡ä»¶ã‚¨ãƒªã‚¢ -->
    <div class="space-y-2 mb-4">
      <div class="flex flex-wrap items-center gap-2">
        <label class="text-gray-700 font-semibold">ğŸ“… æ—¥ä»˜</label>
        <input id="searchFrom" type="date" class="p-2 border rounded" />
        <span class="text-gray-600">ã€œ</span>
        <input id="searchTo" type="date" class="p-2 border rounded" />
        <button onclick="toggleAdvancedSearch()" class="ml-4 text-blue-600 underline">+ è©³ç´°æ¤œç´¢</button>
      </div>

      <div id="advancedSearch" class="hidden grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-2">
        <input id="searchCar" type="text" class="p-2 border rounded w-full" placeholder="ğŸšš è»Šä¸¡ç•ªå·ã§æ¤œç´¢" />
        <select id="searchCompany" class="p-2 border rounded">
          <option value="">ğŸ¢ é‹é€ä¼šç¤¾ã‚’é¸æŠï¼ˆãƒã‚¹ã‚¿å‚ç…§ï¼‰</option>
          <option value="ä¸¸é‹è¼¸">ä¸¸é‹è¼¸</option>
          <option value="æ¸…æ°´ç‰©æµ">æ¸…æ°´ç‰©æµ</option>
        </select>
        <select id="searchBrand" class="p-2 border rounded">
          <option value="">ğŸ§ª éŠ˜æŸ„ã‚’é¸æŠï¼ˆãƒã‚¹ã‚¿å‚ç…§ï¼‰</option>
          <option value="é…åˆA">é…åˆA</option>
          <option value="é…åˆB">é…åˆB</option>
        </select>
        <select id="searchTank" class="p-2 border rounded">
          <option value="">ğŸ›¢ ã‚¿ãƒ³ã‚¯No.ã‚’é¸æŠï¼ˆãƒã‚¹ã‚¿å‚ç…§ï¼‰</option>
          <option value="T-1">T-1</option>
          <option value="T-2">T-2</option>
        </select>
        <input id="searchRemarks" type="text" class="p-2 border rounded w-full" placeholder="ğŸ“ å‚™è€ƒï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰" />
      </div>

      <div class="flex flex-wrap gap-2 mt-2">
        <button onclick="filterRecords()" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">â† æ¤œç´¢ã™ã‚‹</button>
        <button onclick="copyToClipboard()" class="bg-yellow-500 text-white py-2 px-4 rounded hover:bg-yellow-600">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å‡ºåŠ›</button>
      </div>
    </div>

    <!-- ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="overflow-x-auto">
      <table class="min-w-full table-auto border text-sm">
        <thead>
          <tr class="bg-gray-200 text-left">
            <th class="p-2 border cursor-pointer" onclick="sortBy('date')">æ—¥ä»˜</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('duration')">è¨ˆæ¸¬æ™‚é–“</th>
            <th class="p-2 border">é–‹å§‹æ™‚åˆ»</th>
            <th class="p-2 border">çµ‚äº†æ™‚åˆ»</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('location')">å ´æ‰€</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('mode')">å‡ºè·/å—å…¥</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('carNumber')">è»Šä¸¡ç•ªå·</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('company')">é‹é€ä¼šç¤¾</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('brand')">éŠ˜æŸ„</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('tankNumber')">ã‚¿ãƒ³ã‚¯No.</th>
            <th class="p-2 border cursor-pointer" onclick="sortBy('remarks')">å‚™è€ƒ</th>
          </tr>
        </thead>
        <tbody id="recordTable">
          <!-- å‹•çš„ã«æŒ¿å…¥ -->
        </tbody>
      </table>
    </div>

    <div class="mt-4 text-center">
      <a href="index.html" class="text-blue-600 underline">â† è¨˜éŒ²ç”»é¢ã«æˆ»ã‚‹</a>
    </div>
  </div>
</body>
</html>
