<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å®Œäº†æ¸ˆã¿ä¸€è¦§</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 text-base">
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow space-y-6">
    <h1 class="text-xl font-bold text-center text-blue-800">âœ… å®Œäº†æ¸ˆã¿ä¸€è¦§</h1>

    <!-- æ¤œç´¢æ¡ä»¶ã‚¨ãƒªã‚¢ï¼š1æ®µç›®ï¼ˆæ—¥ä»˜ï¼‰ -->
    <div class="flex flex-wrap items-center gap-3 text-sm mb-2">
      <label for="searchDateFrom" class="font-medium text-gray-700 whitespace-nowrap">ğŸ“… æ—¥ä»˜</label>
      <input id="searchDateFrom" type="date" class="p-2 border rounded" />
      <span class="text-gray-500">ã€œ</span>
      <input id="searchDateTo" type="date" class="p-2 border rounded" />
    </div>

    <!-- æ¤œç´¢æ¡ä»¶ã‚¨ãƒªã‚¢ï¼š2æ®µç›®ï¼ˆãã®ä»–ï¼‰ -->
    <div class="flex flex-wrap items-center gap-3 text-sm mb-4">
      <input id="searchCar" type="text" class="p-2 border rounded" placeholder="è»Šä¸¡ç•ªå·ã§æ¤œç´¢" />
      <input id="searchCompany" type="text" class="p-2 border rounded" placeholder="é‹é€ä¼šç¤¾ã§æ¤œç´¢" />
      <input id="searchTank" type="text" class="p-2 border rounded" placeholder="ã‚¿ãƒ³ã‚¯Noã§æ¤œç´¢" />
      <button onclick="filterRecords()" class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold py-2 px-4 rounded-full shadow hover:from-blue-600 hover:to-blue-700 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16l-4-4m0 0l4-4m-4 4h16" /></svg>
        æ¤œç´¢ã™ã‚‹
      </button>
    </div>

    <!-- ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="overflow-x-auto">
      <table class="min-w-full table-auto border text-sm">
        <thead>
          <tr class="bg-gray-200 text-left">
            <th class="p-2 border cursor-pointer" onclick="sortTable('date')">æ—¥ä»˜</th>
            <th class="p-2 border cursor-pointer" onclick="sortTable('carNumber')">è»Šä¸¡ç•ªå·</th>
            <th class="p-2 border cursor-pointer" onclick="sortTable('company')">é‹é€ä¼šç¤¾</th>
            <th class="p-2 border cursor-pointer" onclick="sortTable('tankNumber')">ã‚¿ãƒ³ã‚¯No.</th>
            <th class="p-2 border cursor-pointer" onclick="sortTable('duration')">çµŒéæ™‚é–“</th>
            <th class="p-2 border">å‚™è€ƒ</th>
          </tr>
        </thead>
        <tbody id="recordTable">
          <!-- å‹•çš„ã«æŒ¿å…¥ -->
        </tbody>
      </table>
    </div>

    <!-- æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
    <div class="mt-6 text-center">
      <a href="index.html" class="text-blue-600 underline">â† è¨˜éŒ²ç”»é¢ã«æˆ»ã‚‹</a>
    </div>
  </div>

  <script>
    let currentSortKey = null;
    let currentSortAsc = true;

    function loadRecords() {
      let records = JSON.parse(localStorage.getItem("completedRecords") || "null");
      if (!records) {
        records = [
          { date: "2025-07-22", carNumber: "é™å²¡800ã‚12-34", company: "æ¸¯é‹è¼¸", tankNumber: "T-3", duration: "02:14", remarks: "æœä¸€ç•ªã®ä¾¿" },
          { date: "2025-07-21", carNumber: "æµœæ¾300ã„56-78", company: "æ¸…æ°´æ€¥é€", tankNumber: "T-5", duration: "03:09", remarks: "ç©è¼‰å¤šã‚" },
          { date: "2025-07-20", carNumber: "å¯Œå£«100ã†11-22", company: "ç”²åºœç‰©æµ", tankNumber: "T-1", duration: "02:45", remarks: "" }
        ];
        localStorage.setItem("completedRecords", JSON.stringify(records));
      }
      return records;
    }

    function displayRecords(records) {
      const tbody = document.getElementById("recordTable");
      tbody.innerHTML = "";

      records.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="p-2 border">${record.date}</td>
          <td class="p-2 border">${record.carNumber}</td>
          <td class="p-2 border">${record.company || ''}</td>
          <td class="p-2 border">${record.tankNumber || ''}</td>
          <td class="p-2 border">${record.duration}</td>
          <td class="p-2 border">${record.remarks || ''}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterRecords() {
      const dateFrom = document.getElementById("searchDateFrom").value;
      const dateTo = document.getElementById("searchDateTo").value;
      const car = document.getElementById("searchCar").value.trim();
      const company = document.getElementById("searchCompany").value.trim();
      const tank = document.getElementById("searchTank").value.trim();

      let records = loadRecords();
      records = records.filter(r => {
        return (!dateFrom || r.date >= dateFrom)
          && (!dateTo || r.date <= dateTo)
          && (!car || r.carNumber.includes(car))
          && (!company || (r.company || '').includes(company))
          && (!tank || (r.tankNumber || '').includes(tank));
      });
      if (currentSortKey) {
        records.sort(sortByKey(currentSortKey, currentSortAsc));
      }
      displayRecords(records);
    }

    function sortTable(key) {
      if (currentSortKey === key) {
        currentSortAsc = !currentSortAsc;
      } else {
        currentSortKey = key;
        currentSortAsc = true;
      }
      filterRecords();
    }

    function sortByKey(key, asc = true) {
      return function(a, b) {
        let valA = a[key] || '';
        let valB = b[key] || '';

        if (key === 'duration') {
          const toSec = str => {
            const [h, m] = str.split(":").map(Number);
            return h * 60 + m;
          };
          valA = toSec(valA);
          valB = toSec(valB);
        }

        if (valA < valB) return asc ? -1 : 1;
        if (valA > valB) return asc ? 1 : -1;
        return 0;
      };
    }

    window.onload = () => filterRecords();
  </script>
</body>
</html>
